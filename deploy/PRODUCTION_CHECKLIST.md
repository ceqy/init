# ç”Ÿäº§ç¯å¢ƒéƒ¨ç½²æ£€æŸ¥æ¸…å•

## ğŸ“‹ éƒ¨ç½²å‰æ£€æŸ¥ï¼ˆPre-Deploymentï¼‰

### 1. åŸºç¡€è®¾æ–½å‡†å¤‡

#### 1.1 æœåŠ¡å™¨èµ„æº
- [ ] CPU: è‡³å°‘ 4 æ ¸ï¼ˆæ¨è 8 æ ¸ï¼‰
- [ ] å†…å­˜: è‡³å°‘ 16GBï¼ˆæ¨è 32GBï¼‰
- [ ] ç£ç›˜: è‡³å°‘ 100GB SSDï¼ˆæ¨è 500GBï¼‰
- [ ] ç½‘ç»œ: è‡³å°‘ 1Gbps å¸¦å®½

#### 1.2 æ“ä½œç³»ç»Ÿ
- [ ] Linux å†…æ ¸ç‰ˆæœ¬ >= 4.15
- [ ] Docker ç‰ˆæœ¬ >= 20.10
- [ ] Docker Compose ç‰ˆæœ¬ >= 2.0
- [ ] æ—¶åŒºé…ç½®æ­£ç¡®ï¼ˆUTC æˆ–æœ¬åœ°æ—¶åŒºï¼‰
- [ ] NTP æ—¶é—´åŒæ­¥å·²å¯ç”¨

#### 1.3 ç½‘ç»œé…ç½®
- [ ] é˜²ç«å¢™è§„åˆ™å·²é…ç½®
- [ ] å¿…è¦ç«¯å£å·²å¼€æ”¾ï¼ˆ8080, 50051, 8500, 9090, 3001ï¼‰
- [ ] DNS è§£ææ­£å¸¸
- [ ] è´Ÿè½½å‡è¡¡å™¨å·²é…ç½®ï¼ˆå¦‚æœä½¿ç”¨ï¼‰

### 2. å®‰å…¨é…ç½®

#### 2.1 TLS/SSL
- [ ] CA è¯ä¹¦å·²ç”Ÿæˆ
- [ ] æœåŠ¡è¯ä¹¦å·²ç”Ÿæˆå¹¶ç­¾å
- [ ] è¯ä¹¦æœ‰æ•ˆæœŸæ£€æŸ¥ï¼ˆè‡³å°‘ 30 å¤©ï¼‰
- [ ] è¯ä¹¦æƒé™è®¾ç½®æ­£ç¡®ï¼ˆç§é’¥ 600ï¼‰
- [ ] mTLS åŒå‘è®¤è¯å·²å¯ç”¨
- [ ] è¯ä¹¦è‡ªåŠ¨è½®æ¢å·²é…ç½®

#### 2.2 è®¤è¯æˆæƒ
- [ ] JWT_SECRET å·²è®¾ç½®ï¼ˆè‡³å°‘ 32 å­—ç¬¦ï¼‰
- [ ] æ•°æ®åº“å¯†ç å·²ä¿®æ”¹ï¼ˆä¸ä½¿ç”¨é»˜è®¤å¯†ç ï¼‰
- [ ] Redis å¯†ç å·²è®¾ç½®
- [ ] Consul ACL å·²å¯ç”¨
- [ ] Envoy Admin æ¥å£è®¿é—®æ§åˆ¶å·²é…ç½®

#### 2.3 ç½‘ç»œå®‰å…¨
- [ ] æ‰€æœ‰æœåŠ¡é—´é€šä¿¡å·²åŠ å¯†
- [ ] æ•æ„Ÿç«¯å£ä¸å¯¹å¤–æš´éœ²
- [ ] é˜²ç«å¢™è§„åˆ™æœ€å°åŒ–åŸåˆ™
- [ ] DDoS é˜²æŠ¤å·²å¯ç”¨
- [ ] WAFï¼ˆWeb åº”ç”¨é˜²ç«å¢™ï¼‰å·²é…ç½®

### 3. æ•°æ®æŒä¹…åŒ–

#### 3.1 æ•°æ®åº“
- [ ] PostgreSQL æ•°æ®ç›®å½•å·²æŒ‚è½½åˆ°æŒä¹…åŒ–å­˜å‚¨
- [ ] æ•°æ®åº“è¿æ¥æ± é…ç½®åˆç†
- [ ] æ…¢æŸ¥è¯¢æ—¥å¿—å·²å¯ç”¨
- [ ] æ•°æ®åº“å¤‡ä»½ç­–ç•¥å·²é…ç½®
- [ ] ä¸»ä»å¤åˆ¶å·²é…ç½®ï¼ˆå¦‚æœéœ€è¦ï¼‰

#### 3.2 å¤‡ä»½ç­–ç•¥
- [ ] è‡ªåŠ¨å¤‡ä»½è„šæœ¬å·²éƒ¨ç½²
- [ ] å¤‡ä»½ Cron ä»»åŠ¡å·²é…ç½®
- [ ] å¤‡ä»½æ–‡ä»¶éªŒè¯æœºåˆ¶å·²å®æ–½
- [ ] å¤‡ä»½ä¿ç•™ç­–ç•¥å·²è®¾ç½®ï¼ˆé»˜è®¤ 30 å¤©ï¼‰
- [ ] è¿œç¨‹å¤‡ä»½å­˜å‚¨å·²é…ç½®ï¼ˆS3/OSSï¼‰
- [ ] å¤‡ä»½æ¢å¤æµç¨‹å·²æµ‹è¯•

#### 3.3 å…¶ä»–å­˜å‚¨
- [ ] Redis æŒä¹…åŒ–å·²å¯ç”¨ï¼ˆAOF + RDBï¼‰
- [ ] Kafka æ•°æ®ç›®å½•å·²æŒä¹…åŒ–
- [ ] ClickHouse æ•°æ®ç›®å½•å·²æŒä¹…åŒ–
- [ ] Consul æ•°æ®ç›®å½•å·²æŒä¹…åŒ–

### 4. ç›‘æ§ä¸å‘Šè­¦

#### 4.1 Prometheus
- [ ] Prometheus å·²éƒ¨ç½²
- [ ] æ‰€æœ‰æœåŠ¡æŒ‡æ ‡å·²é‡‡é›†
- [ ] æ•°æ®ä¿ç•™æœŸå·²é…ç½®ï¼ˆé»˜è®¤ 15 å¤©ï¼‰
- [ ] å­˜å‚¨ç©ºé—´å……è¶³

#### 4.2 Grafana
- [ ] Grafana å·²éƒ¨ç½²
- [ ] æ•°æ®æºå·²é…ç½®
- [ ] ä»ªè¡¨ç›˜å·²å¯¼å…¥
- [ ] ç”¨æˆ·æƒé™å·²è®¾ç½®

#### 4.3 Alertmanager
- [ ] Alertmanager å·²éƒ¨ç½²
- [ ] å‘Šè­¦è§„åˆ™å·²é…ç½®
- [ ] é€šçŸ¥æ¸ é“å·²æµ‹è¯•ï¼ˆé‚®ä»¶/Slack/é’‰é’‰ï¼‰
- [ ] å‘Šè­¦è·¯ç”±è§„åˆ™å·²è®¾ç½®
- [ ] å‘Šè­¦æŠ‘åˆ¶è§„åˆ™å·²é…ç½®

#### 4.4 æ—¥å¿—èšåˆ
- [ ] æ—¥å¿—æ”¶é›†ç³»ç»Ÿå·²éƒ¨ç½²ï¼ˆELK/Lokiï¼‰
- [ ] æ‰€æœ‰æœåŠ¡æ—¥å¿—å·²æ¥å…¥
- [ ] æ—¥å¿—ä¿ç•™ç­–ç•¥å·²è®¾ç½®
- [ ] æ—¥å¿—æŸ¥è¯¢æƒé™å·²é…ç½®

### 5. é«˜å¯ç”¨é…ç½®

#### 5.1 Consul é›†ç¾¤
- [ ] Consul é›†ç¾¤èŠ‚ç‚¹æ•° >= 3
- [ ] Consul Leader é€‰ä¸¾æ­£å¸¸
- [ ] Consul å¥åº·æ£€æŸ¥å·²é…ç½®
- [ ] Consul å¤‡ä»½å·²é…ç½®

#### 5.2 è´Ÿè½½å‡è¡¡
- [ ] Envoy è´Ÿè½½å‡è¡¡ç­–ç•¥å·²é…ç½®
- [ ] å¥åº·æ£€æŸ¥é—´éš”åˆç†ï¼ˆ10-30 ç§’ï¼‰
- [ ] ç†”æ–­å™¨é˜ˆå€¼å·²è®¾ç½®
- [ ] é‡è¯•ç­–ç•¥å·²é…ç½®

#### 5.3 æ•…éšœè½¬ç§»
- [ ] æœåŠ¡å¤šå®ä¾‹éƒ¨ç½²ï¼ˆè‡³å°‘ 2 ä¸ªï¼‰
- [ ] è‡ªåŠ¨æ•…éšœè½¬ç§»å·²æµ‹è¯•
- [ ] æ•°æ®åº“ä¸»ä»åˆ‡æ¢å·²æµ‹è¯•
- [ ] ç¾éš¾æ¢å¤è®¡åˆ’å·²åˆ¶å®š

### 6. æ€§èƒ½ä¼˜åŒ–

#### 6.1 èµ„æºé™åˆ¶
- [ ] å®¹å™¨ CPU é™åˆ¶å·²è®¾ç½®
- [ ] å®¹å™¨å†…å­˜é™åˆ¶å·²è®¾ç½®
- [ ] æ•°æ®åº“è¿æ¥æ± å¤§å°åˆç†
- [ ] Envoy è¿æ¥æ± é…ç½®ä¼˜åŒ–

#### 6.2 ç¼“å­˜é…ç½®
- [ ] Redis ç¼“å­˜ç­–ç•¥å·²ä¼˜åŒ–
- [ ] ç¼“å­˜è¿‡æœŸæ—¶é—´åˆç†
- [ ] ç¼“å­˜é¢„çƒ­æœºåˆ¶å·²å®æ–½

#### 6.3 æ€§èƒ½æµ‹è¯•
- [ ] è´Ÿè½½æµ‹è¯•å·²å®Œæˆ
- [ ] å‹åŠ›æµ‹è¯•å·²å®Œæˆ
- [ ] æ€§èƒ½åŸºçº¿å·²å»ºç«‹
- [ ] ç“¶é¢ˆå·²è¯†åˆ«å¹¶ä¼˜åŒ–

### 7. é…ç½®ç®¡ç†

#### 7.1 ç¯å¢ƒå˜é‡
- [ ] .env æ–‡ä»¶å·²é…ç½®
- [ ] æ•æ„Ÿä¿¡æ¯å·²åŠ å¯†å­˜å‚¨
- [ ] ç¯å¢ƒå˜é‡æ–‡æ¡£å·²æ›´æ–°

#### 7.2 é…ç½®æ–‡ä»¶
- [ ] Envoy é…ç½®å·²ä¼˜åŒ–
- [ ] Consul é…ç½®å·²ä¼˜åŒ–
- [ ] Prometheus é…ç½®å·²ä¼˜åŒ–
- [ ] æ‰€æœ‰é…ç½®æ–‡ä»¶å·²ç‰ˆæœ¬æ§åˆ¶

### 8. æ–‡æ¡£ä¸æµç¨‹

#### 8.1 è¿ç»´æ–‡æ¡£
- [ ] éƒ¨ç½²æ–‡æ¡£å·²å®Œå–„
- [ ] æ•…éšœæ’æŸ¥æ‰‹å†Œå·²ç¼–å†™
- [ ] è¿ç»´ Runbook å·²å‡†å¤‡
- [ ] API æ–‡æ¡£å·²æ›´æ–°

#### 8.2 åº”æ€¥é¢„æ¡ˆ
- [ ] ç¾éš¾æ¢å¤è®¡åˆ’å·²åˆ¶å®š
- [ ] åº”æ€¥è”ç³»äººåˆ—è¡¨å·²æ›´æ–°
- [ ] å›æ»šæµç¨‹å·²æ–‡æ¡£åŒ–
- [ ] åº”æ€¥æ¼”ç»ƒå·²å®Œæˆ

---

## ğŸš€ éƒ¨ç½²æ‰§è¡Œï¼ˆDeploymentï¼‰

### 1. éƒ¨ç½²å‰å‡†å¤‡
```bash
# 1. ç”Ÿæˆè¯ä¹¦
cd /path/to/project
./scripts/generate-certs.sh

# 2. é…ç½®ç¯å¢ƒå˜é‡
cp .env.example .env.production
vim .env.production  # ä¿®æ”¹æ‰€æœ‰é…ç½®

# 3. éªŒè¯é…ç½®
docker-compose -f deploy/docker/docker-compose.envoy.yml config

# 4. æ‹‰å–é•œåƒ
docker-compose -f deploy/docker/docker-compose.envoy.yml pull
```

### 2. æ•°æ®åº“åˆå§‹åŒ–
```bash
# 1. å¯åŠ¨æ•°æ®åº“
docker-compose -f deploy/docker/docker-compose.envoy.yml up -d postgres

# 2. ç­‰å¾…æ•°æ®åº“å°±ç»ª
until docker exec cuba-postgres pg_isready -U postgres; do sleep 1; done

# 3. è¿è¡Œè¿ç§»
docker exec cuba-postgres psql -U postgres -d cuba -f /migrations/init.sql

# 4. éªŒè¯æ•°æ®åº“
docker exec cuba-postgres psql -U postgres -d cuba -c "\dt"
```

### 3. å¯åŠ¨æœåŠ¡
```bash
# 1. å¯åŠ¨åŸºç¡€è®¾æ–½
docker-compose -f deploy/docker/docker-compose.envoy.yml up -d \
    consul postgres redis kafka clickhouse

# 2. ç­‰å¾…åŸºç¡€è®¾æ–½å°±ç»ª
sleep 30

# 3. å¯åŠ¨åº”ç”¨æœåŠ¡
docker-compose -f deploy/docker/docker-compose.envoy.yml up -d \
    iam-access iam-access-envoy gateway gateway-envoy

# 4. å¯åŠ¨ç›‘æ§æœåŠ¡
docker-compose -f deploy/docker/docker-compose.envoy.yml up -d \
    prometheus grafana alertmanager
```

### 4. éªŒè¯éƒ¨ç½²
```bash
# 1. æ£€æŸ¥æ‰€æœ‰å®¹å™¨çŠ¶æ€
docker-compose -f deploy/docker/docker-compose.envoy.yml ps

# 2. æ£€æŸ¥ Consul æœåŠ¡æ³¨å†Œ
curl http://localhost:8500/v1/catalog/services

# 3. æ£€æŸ¥ Envoy é›†ç¾¤çŠ¶æ€
curl http://localhost:9901/clusters | grep iam_cluster

# 4. æµ‹è¯• API
curl http://localhost:8080/health

# 5. æ£€æŸ¥ç›‘æ§æŒ‡æ ‡
curl http://localhost:9090/api/v1/targets
```

---

## âœ… éƒ¨ç½²åæ£€æŸ¥ï¼ˆPost-Deploymentï¼‰

### 1. åŠŸèƒ½éªŒè¯
- [ ] å¥åº·æ£€æŸ¥ç«¯ç‚¹æ­£å¸¸
- [ ] ç”¨æˆ·ç™»å½•åŠŸèƒ½æ­£å¸¸
- [ ] API è°ƒç”¨æ­£å¸¸
- [ ] WebSocket è¿æ¥æ­£å¸¸
- [ ] æ•°æ®åº“è¯»å†™æ­£å¸¸

### 2. ç›‘æ§éªŒè¯
- [ ] Prometheus é‡‡é›†æŒ‡æ ‡æ­£å¸¸
- [ ] Grafana ä»ªè¡¨ç›˜æ˜¾ç¤ºæ­£å¸¸
- [ ] Alertmanager å‘Šè­¦è§„åˆ™ç”Ÿæ•ˆ
- [ ] æ—¥å¿—æ”¶é›†æ­£å¸¸

### 3. æ€§èƒ½éªŒè¯
- [ ] API å“åº”æ—¶é—´ < 200ms (P99)
- [ ] æ•°æ®åº“æŸ¥è¯¢æ—¶é—´ < 100ms (P99)
- [ ] CPU ä½¿ç”¨ç‡ < 70%
- [ ] å†…å­˜ä½¿ç”¨ç‡ < 80%

### 4. å®‰å…¨éªŒè¯
- [ ] TLS è¯ä¹¦æœ‰æ•ˆ
- [ ] è®¤è¯æˆæƒæ­£å¸¸
- [ ] æ•æ„Ÿç«¯å£ä¸å¯å¤–éƒ¨è®¿é—®
- [ ] å®‰å…¨æ‰«ææ— é«˜å±æ¼æ´

### 5. å¤‡ä»½éªŒè¯
- [ ] è‡ªåŠ¨å¤‡ä»½ä»»åŠ¡è¿è¡Œæ­£å¸¸
- [ ] å¤‡ä»½æ–‡ä»¶å®Œæ•´æ€§éªŒè¯é€šè¿‡
- [ ] å¤‡ä»½æ¢å¤æµç¨‹æµ‹è¯•é€šè¿‡

---

## ğŸ”„ æŒç»­è¿ç»´ï¼ˆOperationsï¼‰

### æ—¥å¸¸æ£€æŸ¥ï¼ˆæ¯å¤©ï¼‰
- [ ] æ£€æŸ¥æœåŠ¡å¥åº·çŠ¶æ€
- [ ] æŸ¥çœ‹å‘Šè­¦ä¿¡æ¯
- [ ] æ£€æŸ¥ç£ç›˜ç©ºé—´
- [ ] æŸ¥çœ‹é”™è¯¯æ—¥å¿—

### å‘¨æ£€æŸ¥ï¼ˆæ¯å‘¨ï¼‰
- [ ] æ£€æŸ¥å¤‡ä»½å®Œæ•´æ€§
- [ ] æŸ¥çœ‹æ€§èƒ½è¶‹åŠ¿
- [ ] æ£€æŸ¥è¯ä¹¦æœ‰æ•ˆæœŸ
- [ ] æ›´æ–°å®‰å…¨è¡¥ä¸

### æœˆæ£€æŸ¥ï¼ˆæ¯æœˆï¼‰
- [ ] æ‰§è¡Œå¤‡ä»½æ¢å¤æ¼”ç»ƒ
- [ ] å®¡æŸ¥å‘Šè­¦è§„åˆ™
- [ ] å®¹é‡è§„åˆ’è¯„ä¼°
- [ ] å®‰å…¨å®¡è®¡

---

## ğŸ“ åº”æ€¥è”ç³»

| è§’è‰² | å§“å | ç”µè¯ | é‚®ç®± | èŒè´£ |
|------|------|------|------|------|
| è¿ç»´è´Ÿè´£äºº | - | - | ops@cuba-erp.com | æ•´ä½“åè°ƒ |
| DBA | - | - | dba@cuba-erp.com | æ•°æ®åº“é—®é¢˜ |
| å¹³å°å·¥ç¨‹å¸ˆ | - | - | platform@cuba-erp.com | åŸºç¡€è®¾æ–½ |
| å®‰å…¨å·¥ç¨‹å¸ˆ | - | - | security@cuba-erp.com | å®‰å…¨äº‹ä»¶ |

---

## ğŸ“š ç›¸å…³æ–‡æ¡£

- [éƒ¨ç½²æŒ‡å—](ENVOY_DEPLOYMENT_GUIDE.md)
- [TLS é…ç½®æŒ‡å—](TLS_CONFIGURATION_GUIDE.md)
- [ç¾éš¾æ¢å¤æ‰‹å†Œ](DISASTER_RECOVERY.md)
- [æ•…éšœæ’æŸ¥æ‰‹å†Œ](TROUBLESHOOTING.md)
- [æ€§èƒ½è°ƒä¼˜æŒ‡å—](PERFORMANCE_TUNING.md)
