syntax = "proto3";

package fi.gl.v1;


import "google/protobuf/timestamp.proto";
import "google/protobuf/empty.proto";
import "common/v1/base.proto";

service GeneralLedgerService {
    rpc CreateJournalEntry(CreateJournalEntryRequest) returns (CreateJournalEntryResponse);
    rpc GetJournalEntry(GetJournalEntryRequest) returns (GetJournalEntryResponse);
    rpc UpdateJournalEntry(UpdateJournalEntryRequest) returns (UpdateJournalEntryResponse);
    rpc DeleteJournalEntry(DeleteJournalEntryRequest) returns (google.protobuf.Empty);
    rpc ListJournalEntries(ListJournalEntriesRequest) returns (ListJournalEntriesResponse);
    rpc PostJournalEntry(PostJournalEntryRequest) returns (PostJournalEntryResponse);
    rpc ReverseJournalEntry(ReverseJournalEntryRequest) returns (ReverseJournalEntryResponse);

    rpc GetAccountBalance(GetAccountBalanceRequest) returns (GetAccountBalanceResponse);
    rpc GetTrialBalance(GetTrialBalanceRequest) returns (GetTrialBalanceResponse);
    rpc GetBalanceSheet(GetBalanceSheetRequest) returns (GetBalanceSheetResponse);
    rpc GetIncomeStatement(GetIncomeStatementRequest) returns (GetIncomeStatementResponse);
    rpc GetCashFlowStatement(GetCashFlowStatementRequest) returns (GetCashFlowStatementResponse);

    rpc OpenPeriod(OpenPeriodRequest) returns (OpenPeriodResponse);
    rpc ClosePeriod(ClosePeriodRequest) returns (ClosePeriodResponse);
    rpc GetFiscalPeriods(GetFiscalPeriodsRequest) returns (GetFiscalPeriodsResponse);

    rpc ReconcileAccounts(ReconcileAccountsRequest) returns (ReconcileAccountsResponse);
    rpc GetLedgerTransactions(GetLedgerTransactionsRequest) returns (GetLedgerTransactionsResponse);
}

message JournalEntry {
    string id = 1;
    string document_number = 2;
    string company_code = 3;
    google.protobuf.Timestamp posting_date = 4;
    google.protobuf.Timestamp document_date = 5;
    string fiscal_year = 6;
    string fiscal_period = 7;
    string reference = 8;
    string description = 9;
    string currency = 10;
    repeated JournalEntryLine lines = 11;
    JournalEntryStatus status = 12;
    string reversal_reason = 13;
    string reversed_by = 14;
    common.v1.AuditInfo audit_info = 15;
}

message JournalEntryLine {
    string id = 1;
    int32 line_number = 2;
    string account_id = 3;
    string account_code = 4;
    string cost_center = 5;
    string profit_center = 6;
    common.v1.Money debit = 7;
    common.v1.Money credit = 8;
    common.v1.Money local_debit = 9;
    common.v1.Money local_credit = 10;
    string description = 11;
    string trading_partner = 12;
    string assignment = 13;
    map<string, string> dimensions = 14;
}

enum JournalEntryStatus {
    JOURNAL_ENTRY_STATUS_UNSPECIFIED = 0;
    JOURNAL_ENTRY_STATUS_DRAFT = 1;
    JOURNAL_ENTRY_STATUS_POSTED = 2;
    JOURNAL_ENTRY_STATUS_REVERSED = 3;
    JOURNAL_ENTRY_STATUS_PARKED = 4;
}

message FiscalPeriod {
    string id = 1;
    string company_code = 2;
    string fiscal_year = 3;
    string period = 4;
    google.protobuf.Timestamp start_date = 5;
    google.protobuf.Timestamp end_date = 6;
    FiscalPeriodStatus status = 7;
    common.v1.AuditInfo audit_info = 8;
}

enum FiscalPeriodStatus {
    FISCAL_PERIOD_STATUS_UNSPECIFIED = 0;
    FISCAL_PERIOD_STATUS_OPEN = 1;
    FISCAL_PERIOD_STATUS_CLOSED = 2;
    FISCAL_PERIOD_STATUS_LOCKED = 3;
}

message CreateJournalEntryRequest {
    string company_code = 1;
    google.protobuf.Timestamp posting_date = 2;
    google.protobuf.Timestamp document_date = 3;
    string reference = 4;
    string description = 5;
    string currency = 6;
    repeated JournalEntryLineInput lines = 7;
}

message JournalEntryLineInput {
    string account_id = 1;
    string cost_center = 2;
    string profit_center = 3;
    common.v1.Money debit = 4;
    common.v1.Money credit = 5;
    string description = 6;
    string trading_partner = 7;
    string assignment = 8;
    map<string, string> dimensions = 9;
}

message GetJournalEntryRequest {
    string id = 1;
}

message UpdateJournalEntryRequest {
    string id = 1;
    string reference = 2;
    string description = 3;
    repeated JournalEntryLineInput lines = 4;
}

message DeleteJournalEntryRequest {
    string id = 1;
}

message ListJournalEntriesRequest {
    string company_code = 1;
    string fiscal_year = 2;
    string fiscal_period = 3;
    string account_id = 4;
    common.v1.DateRange date_range = 5;
    JournalEntryStatus status = 6;
    common.v1.Pagination pagination = 7;
}

message ListJournalEntriesResponse {
    repeated JournalEntry entries = 1;
    common.v1.PaginationResponse pagination = 2;
}

message PostJournalEntryRequest {
    string id = 1;
}

message ReverseJournalEntryRequest {
    string id = 1;
    google.protobuf.Timestamp reversal_date = 2;
    string reason = 3;
}

message GetAccountBalanceRequest {
    string company_code = 1;
    string account_id = 2;
    string fiscal_year = 3;
    string fiscal_period = 4;
    string cost_center = 5;
    string profit_center = 6;
}

message GetAccountBalanceResponse {
    string account_id = 1;
    string account_code = 2;
    string account_name = 3;
    common.v1.Money opening_balance = 4;
    common.v1.Money debit_total = 5;
    common.v1.Money credit_total = 6;
    common.v1.Money closing_balance = 7;
}

message GetTrialBalanceRequest {
    string company_code = 1;
    string fiscal_year = 2;
    string fiscal_period = 3;
    google.protobuf.Timestamp as_of_date = 4;
}

message GetTrialBalanceResponse {
    repeated TrialBalanceLine lines = 1;
    common.v1.Money total_debit = 2;
    common.v1.Money total_credit = 3;
}

message TrialBalanceLine {
    string account_id = 1;
    string account_code = 2;
    string account_name = 3;
    string account_type = 4;
    common.v1.Money debit_balance = 5;
    common.v1.Money credit_balance = 6;
}

message GetBalanceSheetRequest {
    string company_code = 1;
    google.protobuf.Timestamp as_of_date = 2;
    string comparison_type = 3;
}

message GetBalanceSheetResponse {
    repeated FinancialStatementSection assets = 1;
    repeated FinancialStatementSection liabilities = 2;
    repeated FinancialStatementSection equity = 3;
    common.v1.Money total_assets = 4;
    common.v1.Money total_liabilities = 5;
    common.v1.Money total_equity = 6;
}

message FinancialStatementSection {
    string name = 1;
    repeated FinancialStatementLine lines = 2;
    common.v1.Money subtotal = 3;
}

message FinancialStatementLine {
    string account_id = 1;
    string account_code = 2;
    string account_name = 3;
    common.v1.Money current_amount = 4;
    common.v1.Money previous_amount = 5;
    double variance_percent = 6;
}

message GetIncomeStatementRequest {
    string company_code = 1;
    common.v1.DateRange date_range = 2;
    string comparison_type = 3;
}

message GetIncomeStatementResponse {
    repeated FinancialStatementSection revenue = 1;
    repeated FinancialStatementSection expenses = 2;
    common.v1.Money gross_profit = 3;
    common.v1.Money operating_income = 4;
    common.v1.Money net_income = 5;
}

message GetCashFlowStatementRequest {
    string company_code = 1;
    common.v1.DateRange date_range = 2;
}

message GetCashFlowStatementResponse {
    repeated CashFlowSection operating_activities = 1;
    repeated CashFlowSection investing_activities = 2;
    repeated CashFlowSection financing_activities = 3;
    common.v1.Money net_operating = 4;
    common.v1.Money net_investing = 5;
    common.v1.Money net_financing = 6;
    common.v1.Money net_change = 7;
    common.v1.Money beginning_cash = 8;
    common.v1.Money ending_cash = 9;
}

message CashFlowSection {
    string name = 1;
    common.v1.Money amount = 2;
}

message OpenPeriodRequest {
    string company_code = 1;
    string fiscal_year = 2;
    string period = 3;
}

message ClosePeriodRequest {
    string company_code = 1;
    string fiscal_year = 2;
    string period = 3;
}

message GetFiscalPeriodsRequest {
    string company_code = 1;
    string fiscal_year = 2;
}

message GetFiscalPeriodsResponse {
    repeated FiscalPeriod periods = 1;
}

message ReconcileAccountsRequest {
    string company_code = 1;
    string account_id = 2;
    common.v1.DateRange date_range = 3;
}

message ReconcileAccountsResponse {
    repeated ReconciliationItem items = 1;
    common.v1.Money unreconciled_balance = 2;
}

message ReconciliationItem {
    string transaction_id = 1;
    google.protobuf.Timestamp date = 2;
    string description = 3;
    common.v1.Money amount = 4;
    bool reconciled = 5;
    string matched_with = 6;
}

message GetLedgerTransactionsRequest {
    string company_code = 1;
    string account_id = 2;
    common.v1.DateRange date_range = 3;
    common.v1.Pagination pagination = 4;
}

message GetLedgerTransactionsResponse {
    repeated LedgerTransaction transactions = 1;
    common.v1.PaginationResponse pagination = 2;
}

message LedgerTransaction {
    string id = 1;
    string document_number = 2;
    google.protobuf.Timestamp posting_date = 3;
    string account_id = 4;
    string account_code = 5;
    string description = 6;
    common.v1.Money debit = 7;
    common.v1.Money credit = 8;
    common.v1.Money running_balance = 9;
    string reference = 10;
    string source_module = 11;
}

// Auto-generated Response messages
message CreateJournalEntryResponse {
    JournalEntry journal_entry = 1;
}

message GetJournalEntryResponse {
    JournalEntry journal_entry = 1;
}

message UpdateJournalEntryResponse {
    JournalEntry journal_entry = 1;
}

message PostJournalEntryResponse {
    JournalEntry journal_entry = 1;
}

message ReverseJournalEntryResponse {
    JournalEntry journal_entry = 1;
}

message OpenPeriodResponse {
    FiscalPeriod fiscal_period = 1;
}

message ClosePeriodResponse {
    FiscalPeriod fiscal_period = 1;
}
