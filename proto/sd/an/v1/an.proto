syntax = "proto3";

package sd.an.v1;


import "google/protobuf/timestamp.proto";
import "common/v1/base.proto";

service SalesAnalyticsService {
    rpc GetSalesSummary(GetSalesSummaryRequest) returns (GetSalesSummaryResponse);
    rpc GetSalesTrend(GetSalesTrendRequest) returns (GetSalesTrendResponse);
    rpc GetSalesByProduct(GetSalesByProductRequest) returns (GetSalesByProductResponse);
    rpc GetSalesByCustomer(GetSalesByCustomerRequest) returns (GetSalesByCustomerResponse);
    rpc GetSalesByRegion(GetSalesByRegionRequest) returns (GetSalesByRegionResponse);
    rpc GetSalesBySalesRep(GetSalesBySalesRepRequest) returns (GetSalesBySalesRepResponse);

    rpc GetTopProducts(GetTopProductsRequest) returns (GetTopProductsResponse);
    rpc GetTopCustomers(GetTopCustomersRequest) returns (GetTopCustomersResponse);

    rpc GetOrderAnalytics(GetOrderAnalyticsRequest) returns (GetOrderAnalyticsResponse);
    rpc GetQuotationAnalytics(GetQuotationAnalyticsRequest) returns (GetQuotationAnalyticsResponse);
    rpc GetDeliveryPerformance(GetDeliveryPerformanceRequest) returns (GetDeliveryPerformanceResponse);

    rpc GetRevenueAnalysis(GetRevenueAnalysisRequest) returns (GetRevenueAnalysisResponse);
    rpc GetMarginAnalysis(GetMarginAnalysisRequest) returns (GetMarginAnalysisResponse);

    rpc GetSalesForecast(GetSalesForecastRequest) returns (GetSalesForecastResponse);
    rpc GetPipelineAnalysis(GetPipelineAnalysisRequest) returns (GetPipelineAnalysisResponse);

    rpc CreateReport(CreateReportRequest) returns (CreateReportResponse);
    rpc GetReport(GetReportRequest) returns (GetReportResponse);
    rpc ListReports(ListReportsRequest) returns (ListReportsResponse);
    rpc ExportReport(ExportReportRequest) returns (ExportReportResponse);
}

message GetSalesSummaryRequest {
    string company_code = 1;
    string sales_organization = 2;
    common.v1.DateRange date_range = 3;
    string currency = 4;
}

message GetSalesSummaryResponse {
    common.v1.Money total_revenue = 1;
    common.v1.Money total_cost = 2;
    common.v1.Money gross_margin = 3;
    double margin_percentage = 4;
    int32 order_count = 5;
    int32 customer_count = 6;
    common.v1.Money average_order_value = 7;
    ComparisonMetrics comparison = 8;
}

message ComparisonMetrics {
    common.v1.Money previous_revenue = 1;
    double revenue_change_percentage = 2;
    int32 previous_order_count = 3;
    double order_count_change_percentage = 4;
    double previous_margin_percentage = 5;
    double margin_change = 6;
}

message GetSalesTrendRequest {
    string company_code = 1;
    string sales_organization = 2;
    common.v1.DateRange date_range = 3;
    string granularity = 4;
    string currency = 5;
}

message GetSalesTrendResponse {
    repeated SalesTrendPoint data_points = 1;
    common.v1.Money total = 2;
    double average = 3;
    double growth_rate = 4;
}

message SalesTrendPoint {
    google.protobuf.Timestamp date = 1;
    common.v1.Money revenue = 2;
    common.v1.Money cost = 3;
    common.v1.Money margin = 4;
    int32 order_count = 5;
    common.v1.Quantity quantity = 6;
}

message GetSalesByProductRequest {
    string company_code = 1;
    common.v1.DateRange date_range = 2;
    string product_group = 3;
    int32 limit = 4;
    common.v1.Pagination pagination = 5;
}

message GetSalesByProductResponse {
    repeated ProductSalesData products = 1;
    common.v1.PaginationResponse pagination = 2;
}

message ProductSalesData {
    string product_id = 1;
    string product_code = 2;
    string product_name = 3;
    string product_group = 4;
    common.v1.Money revenue = 5;
    common.v1.Money cost = 6;
    common.v1.Money margin = 7;
    double margin_percentage = 8;
    common.v1.Quantity quantity_sold = 9;
    int32 order_count = 10;
    double revenue_share = 11;
}

message GetSalesByCustomerRequest {
    string company_code = 1;
    common.v1.DateRange date_range = 2;
    string customer_group = 3;
    int32 limit = 4;
    common.v1.Pagination pagination = 5;
}

message GetSalesByCustomerResponse {
    repeated CustomerSalesData customers = 1;
    common.v1.PaginationResponse pagination = 2;
}

message CustomerSalesData {
    string customer_id = 1;
    string customer_name = 2;
    string customer_group = 3;
    string region = 4;
    common.v1.Money revenue = 5;
    common.v1.Money margin = 6;
    double margin_percentage = 7;
    int32 order_count = 8;
    common.v1.Money average_order_value = 9;
    double revenue_share = 10;
    google.protobuf.Timestamp last_order_date = 11;
}

message GetSalesByRegionRequest {
    string company_code = 1;
    common.v1.DateRange date_range = 2;
    string region_level = 3;
}

message GetSalesByRegionResponse {
    repeated RegionSalesData regions = 1;
}

message RegionSalesData {
    string region_code = 1;
    string region_name = 2;
    string country = 3;
    common.v1.Money revenue = 4;
    int32 order_count = 5;
    int32 customer_count = 6;
    double revenue_share = 7;
    double growth_rate = 8;
}

message GetSalesBySalesRepRequest {
    string company_code = 1;
    common.v1.DateRange date_range = 2;
    common.v1.Pagination pagination = 3;
}

message GetSalesBySalesRepResponse {
    repeated SalesRepData sales_reps = 1;
    common.v1.PaginationResponse pagination = 2;
}

message SalesRepData {
    string sales_rep_id = 1;
    string sales_rep_name = 2;
    string team = 3;
    common.v1.Money revenue = 4;
    common.v1.Money quota = 5;
    double quota_attainment = 6;
    int32 order_count = 7;
    int32 customer_count = 8;
    int32 new_customers = 9;
    common.v1.Money pipeline_value = 10;
}

message GetTopProductsRequest {
    string company_code = 1;
    common.v1.DateRange date_range = 2;
    int32 limit = 3;
    string metric = 4;
}

message GetTopProductsResponse {
    repeated ProductSalesData products = 1;
}

message GetTopCustomersRequest {
    string company_code = 1;
    common.v1.DateRange date_range = 2;
    int32 limit = 3;
    string metric = 4;
}

message GetTopCustomersResponse {
    repeated CustomerSalesData customers = 1;
}

message GetOrderAnalyticsRequest {
    string company_code = 1;
    common.v1.DateRange date_range = 2;
}

message GetOrderAnalyticsResponse {
    int32 total_orders = 1;
    int32 draft_orders = 2;
    int32 pending_orders = 3;
    int32 completed_orders = 4;
    int32 cancelled_orders = 5;
    double cancellation_rate = 6;
    double average_order_value = 7;
    double average_lines_per_order = 8;
    double average_processing_time_hours = 9;
    repeated OrderStatusBreakdown status_breakdown = 10;
}

message OrderStatusBreakdown {
    string status = 1;
    int32 count = 2;
    common.v1.Money value = 3;
    double percentage = 4;
}

message GetQuotationAnalyticsRequest {
    string company_code = 1;
    common.v1.DateRange date_range = 2;
}

message GetQuotationAnalyticsResponse {
    int32 total_quotations = 1;
    int32 converted_quotations = 2;
    double conversion_rate = 3;
    common.v1.Money total_quoted_value = 4;
    common.v1.Money converted_value = 5;
    double average_quote_value = 6;
    double average_days_to_convert = 7;
    repeated QuotationStatusBreakdown status_breakdown = 8;
}

message QuotationStatusBreakdown {
    string status = 1;
    int32 count = 2;
    common.v1.Money value = 3;
    double percentage = 4;
}

message GetDeliveryPerformanceRequest {
    string company_code = 1;
    common.v1.DateRange date_range = 2;
}

message GetDeliveryPerformanceResponse {
    int32 total_deliveries = 1;
    int32 on_time_deliveries = 2;
    int32 late_deliveries = 3;
    double on_time_percentage = 4;
    double average_delay_days = 5;
    int32 complete_deliveries = 6;
    int32 partial_deliveries = 7;
    double fill_rate = 8;
    repeated DeliveryPerformanceByPeriod by_period = 9;
}

message DeliveryPerformanceByPeriod {
    string period = 1;
    int32 total = 2;
    int32 on_time = 3;
    double on_time_percentage = 4;
}

message GetRevenueAnalysisRequest {
    string company_code = 1;
    common.v1.DateRange date_range = 2;
    repeated string dimensions = 3;
    string comparison_period = 4;
}

message GetRevenueAnalysisResponse {
    common.v1.Money total_revenue = 1;
    common.v1.Money recurring_revenue = 2;
    common.v1.Money one_time_revenue = 3;
    double recurring_percentage = 4;
    repeated RevenueDimensionBreakdown breakdowns = 5;
    RevenueComparison comparison = 6;
}

message RevenueDimensionBreakdown {
    string dimension = 1;
    string value = 2;
    common.v1.Money revenue = 3;
    double percentage = 4;
}

message RevenueComparison {
    common.v1.Money current_period = 1;
    common.v1.Money previous_period = 2;
    double change_amount = 3;
    double change_percentage = 4;
}

message GetMarginAnalysisRequest {
    string company_code = 1;
    common.v1.DateRange date_range = 2;
    string group_by = 3;
}

message GetMarginAnalysisResponse {
    common.v1.Money total_revenue = 1;
    common.v1.Money total_cost = 2;
    common.v1.Money gross_margin = 3;
    double gross_margin_percentage = 4;
    repeated MarginBreakdown breakdowns = 5;
}

message MarginBreakdown {
    string group_key = 1;
    string group_value = 2;
    common.v1.Money revenue = 3;
    common.v1.Money cost = 4;
    common.v1.Money margin = 5;
    double margin_percentage = 6;
}

message GetSalesForecastRequest {
    string company_code = 1;
    int32 forecast_periods = 2;
    string granularity = 3;
    string method = 4;
}

message GetSalesForecastResponse {
    repeated ForecastPoint forecasts = 1;
    double confidence_level = 2;
    common.v1.Money total_forecast = 3;
    string method_used = 4;
}

message ForecastPoint {
    google.protobuf.Timestamp date = 1;
    common.v1.Money forecast_value = 2;
    common.v1.Money lower_bound = 3;
    common.v1.Money upper_bound = 4;
}

message GetPipelineAnalysisRequest {
    string company_code = 1;
    google.protobuf.Timestamp as_of_date = 2;
}

message GetPipelineAnalysisResponse {
    common.v1.Money total_pipeline_value = 1;
    common.v1.Money weighted_pipeline_value = 2;
    int32 total_opportunities = 3;
    double average_deal_size = 4;
    double average_win_rate = 5;
    repeated PipelineStage stages = 6;
}

message PipelineStage {
    string stage_name = 1;
    int32 opportunity_count = 2;
    common.v1.Money value = 3;
    double win_probability = 4;
    common.v1.Money weighted_value = 5;
    double average_days_in_stage = 6;
}

message Report {
    string id = 1;
    string name = 2;
    string description = 3;
    string report_type = 4;
    string company_code = 5;
    map<string, string> parameters = 6;
    string schedule = 7;
    repeated string recipients = 8;
    string format = 9;
    google.protobuf.Timestamp last_run = 10;
    common.v1.AuditInfo audit_info = 11;
}

message CreateReportRequest {
    string name = 1;
    string description = 2;
    string report_type = 3;
    string company_code = 4;
    map<string, string> parameters = 5;
    string schedule = 6;
    repeated string recipients = 7;
    string format = 8;
}

message GetReportRequest {
    string id = 1;
}

message ListReportsRequest {
    string company_code = 1;
    string report_type = 2;
    common.v1.Pagination pagination = 3;
}

message ListReportsResponse {
    repeated Report reports = 1;
    common.v1.PaginationResponse pagination = 2;
}

message ExportReportRequest {
    string report_id = 1;
    string format = 2;
    map<string, string> parameters = 3;
}

message ExportReportResponse {
    bytes content = 1;
    string filename = 2;
    string content_type = 3;
}

// Auto-generated Response messages
message CreateReportResponse {
    Report report = 1;
}

message GetReportResponse {
    Report report = 1;
}
