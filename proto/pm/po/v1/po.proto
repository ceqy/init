syntax = "proto3";

package pm.po.v1;


import "google/protobuf/timestamp.proto";
import "google/protobuf/empty.proto";
import "common/v1/base.proto";

service PurchaseOrderService {
    rpc CreatePurchaseOrder(CreatePurchaseOrderRequest) returns (CreatePurchaseOrderResponse);
    rpc GetPurchaseOrder(GetPurchaseOrderRequest) returns (GetPurchaseOrderResponse);
    rpc UpdatePurchaseOrder(UpdatePurchaseOrderRequest) returns (UpdatePurchaseOrderResponse);
    rpc DeletePurchaseOrder(DeletePurchaseOrderRequest) returns (google.protobuf.Empty);
    rpc ListPurchaseOrders(ListPurchaseOrdersRequest) returns (ListPurchaseOrdersResponse);

    rpc SubmitPurchaseOrder(SubmitPurchaseOrderRequest) returns (SubmitPurchaseOrderResponse);
    rpc ApprovePurchaseOrder(ApprovePurchaseOrderRequest) returns (ApprovePurchaseOrderResponse);
    rpc RejectPurchaseOrder(RejectPurchaseOrderRequest) returns (RejectPurchaseOrderResponse);
    rpc CancelPurchaseOrder(CancelPurchaseOrderRequest) returns (CancelPurchaseOrderResponse);
    rpc ClosePurchaseOrder(ClosePurchaseOrderRequest) returns (ClosePurchaseOrderResponse);

    rpc CreatePurchaseRequisition(CreatePurchaseRequisitionRequest) returns (CreatePurchaseRequisitionResponse);
    rpc GetPurchaseRequisition(GetPurchaseRequisitionRequest) returns (GetPurchaseRequisitionResponse);
    rpc UpdatePurchaseRequisition(UpdatePurchaseRequisitionRequest) returns (UpdatePurchaseRequisitionResponse);
    rpc ListPurchaseRequisitions(ListPurchaseRequisitionsRequest) returns (ListPurchaseRequisitionsResponse);
    rpc ConvertRequisitionToOrder(ConvertRequisitionToOrderRequest) returns (ConvertRequisitionToOrderResponse);

    rpc CreateGoodsReceipt(CreateGoodsReceiptRequest) returns (CreateGoodsReceiptResponse);
    rpc GetGoodsReceipt(GetGoodsReceiptRequest) returns (GetGoodsReceiptResponse);
    rpc ListGoodsReceipts(ListGoodsReceiptsRequest) returns (ListGoodsReceiptsResponse);
    rpc PostGoodsReceipt(PostGoodsReceiptRequest) returns (PostGoodsReceiptResponse);
    rpc ReverseGoodsReceipt(ReverseGoodsReceiptRequest) returns (ReverseGoodsReceiptResponse);

    rpc GetOrderFulfillmentStatus(GetOrderFulfillmentStatusRequest) returns (GetOrderFulfillmentStatusResponse);
    rpc GetPendingReceipts(GetPendingReceiptsRequest) returns (GetPendingReceiptsResponse);
}

message PurchaseOrder {
    string id = 1;
    string order_number = 2;
    string company_code = 3;
    string purchasing_organization = 4;
    string purchasing_group = 5;
    string vendor_id = 6;
    string vendor_name = 7;
    google.protobuf.Timestamp order_date = 8;
    google.protobuf.Timestamp delivery_date = 9;
    string currency = 10;
    string payment_terms = 11;
    string incoterms = 12;
    string incoterms_location = 13;
    common.v1.Money net_value = 14;
    common.v1.Money tax_amount = 15;
    common.v1.Money gross_value = 16;
    repeated PurchaseOrderLine lines = 17;
    PurchaseOrderStatus status = 18;
    string requisition_reference = 19;
    string contract_reference = 20;
    common.v1.Address shipping_address = 21;
    common.v1.Address billing_address = 22;
    string notes = 23;
    repeated ApprovalStep approvals = 24;
    common.v1.AuditInfo audit_info = 25;
}

message PurchaseOrderLine {
    string id = 1;
    int32 line_number = 2;
    string product_id = 3;
    string product_code = 4;
    string description = 5;
    common.v1.Quantity quantity = 6;
    common.v1.Quantity received_quantity = 7;
    common.v1.Quantity invoiced_quantity = 8;
    common.v1.Money unit_price = 9;
    common.v1.Money net_value = 10;
    string tax_code = 11;
    common.v1.Money tax_amount = 12;
    google.protobuf.Timestamp delivery_date = 13;
    string plant = 14;
    string storage_location = 15;
    string cost_center = 16;
    string gl_account = 17;
    string asset_number = 18;
    string internal_order = 19;
    PurchaseOrderLineStatus status = 20;
    bool goods_receipt_required = 21;
    bool invoice_receipt_required = 22;
}

enum PurchaseOrderStatus {
    PURCHASE_ORDER_STATUS_UNSPECIFIED = 0;
    PURCHASE_ORDER_STATUS_DRAFT = 1;
    PURCHASE_ORDER_STATUS_SUBMITTED = 2;
    PURCHASE_ORDER_STATUS_PENDING_APPROVAL = 3;
    PURCHASE_ORDER_STATUS_APPROVED = 4;
    PURCHASE_ORDER_STATUS_REJECTED = 5;
    PURCHASE_ORDER_STATUS_SENT = 6;
    PURCHASE_ORDER_STATUS_CONFIRMED = 7;
    PURCHASE_ORDER_STATUS_PARTIALLY_RECEIVED = 8;
    PURCHASE_ORDER_STATUS_RECEIVED = 9;
    PURCHASE_ORDER_STATUS_COMPLETED = 10;
    PURCHASE_ORDER_STATUS_CANCELLED = 11;
    PURCHASE_ORDER_STATUS_CLOSED = 12;
}

enum PurchaseOrderLineStatus {
    PURCHASE_ORDER_LINE_STATUS_UNSPECIFIED = 0;
    PURCHASE_ORDER_LINE_STATUS_OPEN = 1;
    PURCHASE_ORDER_LINE_STATUS_PARTIALLY_RECEIVED = 2;
    PURCHASE_ORDER_LINE_STATUS_RECEIVED = 3;
    PURCHASE_ORDER_LINE_STATUS_INVOICED = 4;
    PURCHASE_ORDER_LINE_STATUS_CLOSED = 5;
    PURCHASE_ORDER_LINE_STATUS_CANCELLED = 6;
}

message ApprovalStep {
    int32 step = 1;
    string approver_id = 2;
    string approver_name = 3;
    string role = 4;
    ApprovalStatus status = 5;
    google.protobuf.Timestamp decision_date = 6;
    string comments = 7;
}

enum ApprovalStatus {
    APPROVAL_STATUS_UNSPECIFIED = 0;
    APPROVAL_STATUS_PENDING = 1;
    APPROVAL_STATUS_APPROVED = 2;
    APPROVAL_STATUS_REJECTED = 3;
    APPROVAL_STATUS_DELEGATED = 4;
}

message PurchaseRequisition {
    string id = 1;
    string requisition_number = 2;
    string company_code = 3;
    string requester_id = 4;
    string requester_name = 5;
    string department = 6;
    google.protobuf.Timestamp requisition_date = 7;
    google.protobuf.Timestamp required_date = 8;
    string currency = 9;
    common.v1.Money total_value = 10;
    repeated PurchaseRequisitionLine lines = 11;
    PurchaseRequisitionStatus status = 12;
    string justification = 13;
    int32 priority = 14;
    repeated ApprovalStep approvals = 15;
    common.v1.AuditInfo audit_info = 16;
}

message PurchaseRequisitionLine {
    string id = 1;
    int32 line_number = 2;
    string product_id = 3;
    string product_code = 4;
    string description = 5;
    common.v1.Quantity quantity = 6;
    common.v1.Money estimated_price = 7;
    common.v1.Money total_value = 8;
    google.protobuf.Timestamp required_date = 9;
    string plant = 10;
    string storage_location = 11;
    string cost_center = 12;
    string gl_account = 13;
    string preferred_vendor_id = 14;
    string source_type = 15;
    PurchaseRequisitionLineStatus status = 16;
}

enum PurchaseRequisitionStatus {
    PURCHASE_REQUISITION_STATUS_UNSPECIFIED = 0;
    PURCHASE_REQUISITION_STATUS_DRAFT = 1;
    PURCHASE_REQUISITION_STATUS_SUBMITTED = 2;
    PURCHASE_REQUISITION_STATUS_PENDING_APPROVAL = 3;
    PURCHASE_REQUISITION_STATUS_APPROVED = 4;
    PURCHASE_REQUISITION_STATUS_REJECTED = 5;
    PURCHASE_REQUISITION_STATUS_ORDERED = 6;
    PURCHASE_REQUISITION_STATUS_PARTIALLY_ORDERED = 7;
    PURCHASE_REQUISITION_STATUS_CLOSED = 8;
    PURCHASE_REQUISITION_STATUS_CANCELLED = 9;
}

enum PurchaseRequisitionLineStatus {
    PURCHASE_REQUISITION_LINE_STATUS_UNSPECIFIED = 0;
    PURCHASE_REQUISITION_LINE_STATUS_OPEN = 1;
    PURCHASE_REQUISITION_LINE_STATUS_ASSIGNED = 2;
    PURCHASE_REQUISITION_LINE_STATUS_ORDERED = 3;
    PURCHASE_REQUISITION_LINE_STATUS_CLOSED = 4;
    PURCHASE_REQUISITION_LINE_STATUS_CANCELLED = 5;
}

message GoodsReceipt {
    string id = 1;
    string receipt_number = 2;
    string company_code = 3;
    string purchase_order_id = 4;
    string purchase_order_number = 5;
    string vendor_id = 6;
    string vendor_name = 7;
    google.protobuf.Timestamp receipt_date = 8;
    google.protobuf.Timestamp posting_date = 9;
    string delivery_note = 10;
    string bill_of_lading = 11;
    repeated GoodsReceiptLine lines = 12;
    GoodsReceiptStatus status = 13;
    string plant = 14;
    string storage_location = 15;
    string notes = 16;
    common.v1.AuditInfo audit_info = 17;
}

message GoodsReceiptLine {
    string id = 1;
    int32 line_number = 2;
    string po_line_id = 3;
    string product_id = 4;
    string product_code = 5;
    string description = 6;
    common.v1.Quantity quantity = 7;
    string unit = 8;
    string batch_number = 9;
    string serial_number = 10;
    string storage_location = 11;
    string stock_type = 12;
    common.v1.Money unit_price = 13;
    common.v1.Money total_value = 14;
    bool quality_inspection_required = 15;
}

enum GoodsReceiptStatus {
    GOODS_RECEIPT_STATUS_UNSPECIFIED = 0;
    GOODS_RECEIPT_STATUS_DRAFT = 1;
    GOODS_RECEIPT_STATUS_POSTED = 2;
    GOODS_RECEIPT_STATUS_REVERSED = 3;
    GOODS_RECEIPT_STATUS_CANCELLED = 4;
}

message CreatePurchaseOrderRequest {
    string company_code = 1;
    string purchasing_organization = 2;
    string purchasing_group = 3;
    string vendor_id = 4;
    google.protobuf.Timestamp delivery_date = 5;
    string currency = 6;
    string payment_terms = 7;
    string incoterms = 8;
    string incoterms_location = 9;
    repeated PurchaseOrderLineInput lines = 10;
    string requisition_reference = 11;
    string contract_reference = 12;
    common.v1.Address shipping_address = 13;
    string notes = 14;
}

message PurchaseOrderLineInput {
    string product_id = 1;
    string description = 2;
    common.v1.Quantity quantity = 3;
    common.v1.Money unit_price = 4;
    string tax_code = 5;
    google.protobuf.Timestamp delivery_date = 6;
    string plant = 7;
    string storage_location = 8;
    string cost_center = 9;
    string gl_account = 10;
    string asset_number = 11;
    string internal_order = 12;
    bool goods_receipt_required = 13;
    bool invoice_receipt_required = 14;
}

message GetPurchaseOrderRequest {
    string id = 1;
}

message UpdatePurchaseOrderRequest {
    string id = 1;
    google.protobuf.Timestamp delivery_date = 2;
    string payment_terms = 3;
    repeated PurchaseOrderLineInput lines = 4;
    common.v1.Address shipping_address = 5;
    string notes = 6;
}

message DeletePurchaseOrderRequest {
    string id = 1;
}

message ListPurchaseOrdersRequest {
    string company_code = 1;
    string vendor_id = 2;
    string purchasing_organization = 3;
    PurchaseOrderStatus status = 4;
    common.v1.DateRange date_range = 5;
    string search = 6;
    common.v1.Pagination pagination = 7;
}

message ListPurchaseOrdersResponse {
    repeated PurchaseOrder orders = 1;
    common.v1.PaginationResponse pagination = 2;
}

message SubmitPurchaseOrderRequest {
    string id = 1;
}

message ApprovePurchaseOrderRequest {
    string id = 1;
    string approver_id = 2;
    string comments = 3;
}

message RejectPurchaseOrderRequest {
    string id = 1;
    string approver_id = 2;
    string reason = 3;
}

message CancelPurchaseOrderRequest {
    string id = 1;
    string reason = 2;
}

message ClosePurchaseOrderRequest {
    string id = 1;
}

message CreatePurchaseRequisitionRequest {
    string company_code = 1;
    string requester_id = 2;
    string department = 3;
    google.protobuf.Timestamp required_date = 4;
    string currency = 5;
    repeated PurchaseRequisitionLineInput lines = 6;
    string justification = 7;
    int32 priority = 8;
}

message PurchaseRequisitionLineInput {
    string product_id = 1;
    string description = 2;
    common.v1.Quantity quantity = 3;
    common.v1.Money estimated_price = 4;
    google.protobuf.Timestamp required_date = 5;
    string plant = 6;
    string storage_location = 7;
    string cost_center = 8;
    string gl_account = 9;
    string preferred_vendor_id = 10;
}

message GetPurchaseRequisitionRequest {
    string id = 1;
}

message UpdatePurchaseRequisitionRequest {
    string id = 1;
    google.protobuf.Timestamp required_date = 2;
    repeated PurchaseRequisitionLineInput lines = 3;
    string justification = 4;
    int32 priority = 5;
}

message ListPurchaseRequisitionsRequest {
    string company_code = 1;
    string requester_id = 2;
    string department = 3;
    PurchaseRequisitionStatus status = 4;
    common.v1.DateRange date_range = 5;
    common.v1.Pagination pagination = 6;
}

message ListPurchaseRequisitionsResponse {
    repeated PurchaseRequisition requisitions = 1;
    common.v1.PaginationResponse pagination = 2;
}

message ConvertRequisitionToOrderRequest {
    string requisition_id = 1;
    string vendor_id = 2;
    repeated string line_ids = 3;
}

message CreateGoodsReceiptRequest {
    string purchase_order_id = 1;
    google.protobuf.Timestamp receipt_date = 2;
    string delivery_note = 3;
    string bill_of_lading = 4;
    repeated GoodsReceiptLineInput lines = 5;
    string notes = 6;
}

message GoodsReceiptLineInput {
    string po_line_id = 1;
    common.v1.Quantity quantity = 2;
    string batch_number = 3;
    string serial_number = 4;
    string storage_location = 5;
    string stock_type = 6;
}

message GetGoodsReceiptRequest {
    string id = 1;
}

message ListGoodsReceiptsRequest {
    string company_code = 1;
    string purchase_order_id = 2;
    string vendor_id = 3;
    GoodsReceiptStatus status = 4;
    common.v1.DateRange date_range = 5;
    common.v1.Pagination pagination = 6;
}

message ListGoodsReceiptsResponse {
    repeated GoodsReceipt receipts = 1;
    common.v1.PaginationResponse pagination = 2;
}

message PostGoodsReceiptRequest {
    string id = 1;
    google.protobuf.Timestamp posting_date = 2;
}

message ReverseGoodsReceiptRequest {
    string id = 1;
    string reason = 2;
}

message GetOrderFulfillmentStatusRequest {
    string id = 1;
}

message GetOrderFulfillmentStatusResponse {
    string order_id = 1;
    string order_number = 2;
    PurchaseOrderStatus status = 3;
    repeated POLineFulfillmentStatus lines = 4;
    double overall_receipt_percentage = 5;
    double overall_invoice_percentage = 6;
}

message POLineFulfillmentStatus {
    string line_id = 1;
    int32 line_number = 2;
    string product_code = 3;
    common.v1.Quantity ordered_quantity = 4;
    common.v1.Quantity received_quantity = 5;
    common.v1.Quantity invoiced_quantity = 6;
    double receipt_percentage = 7;
    double invoice_percentage = 8;
}

message GetPendingReceiptsRequest {
    string company_code = 1;
    string vendor_id = 2;
    string plant = 3;
    common.v1.Pagination pagination = 4;
}

message GetPendingReceiptsResponse {
    repeated PendingReceiptItem items = 1;
    common.v1.PaginationResponse pagination = 2;
}

message PendingReceiptItem {
    string purchase_order_id = 1;
    string purchase_order_number = 2;
    string line_id = 3;
    int32 line_number = 4;
    string vendor_id = 5;
    string vendor_name = 6;
    string product_id = 7;
    string product_code = 8;
    string description = 9;
    common.v1.Quantity ordered_quantity = 10;
    common.v1.Quantity received_quantity = 11;
    common.v1.Quantity pending_quantity = 12;
    google.protobuf.Timestamp expected_date = 13;
    int32 days_overdue = 14;
}

// Auto-generated Response messages
message CreatePurchaseOrderResponse {
    PurchaseOrder purchase_order = 1;
}

message GetPurchaseOrderResponse {
    PurchaseOrder purchase_order = 1;
}

message UpdatePurchaseOrderResponse {
    PurchaseOrder purchase_order = 1;
}

message SubmitPurchaseOrderResponse {
    PurchaseOrder purchase_order = 1;
}

message ApprovePurchaseOrderResponse {
    PurchaseOrder purchase_order = 1;
}

message RejectPurchaseOrderResponse {
    PurchaseOrder purchase_order = 1;
}

message CancelPurchaseOrderResponse {
    PurchaseOrder purchase_order = 1;
}

message ClosePurchaseOrderResponse {
    PurchaseOrder purchase_order = 1;
}

message CreatePurchaseRequisitionResponse {
    PurchaseRequisition purchase_requisition = 1;
}

message GetPurchaseRequisitionResponse {
    PurchaseRequisition purchase_requisition = 1;
}

message UpdatePurchaseRequisitionResponse {
    PurchaseRequisition purchase_requisition = 1;
}

message ConvertRequisitionToOrderResponse {
    PurchaseOrder purchase_order = 1;
}

message CreateGoodsReceiptResponse {
    GoodsReceipt goods_receipt = 1;
}

message GetGoodsReceiptResponse {
    GoodsReceipt goods_receipt = 1;
}

message PostGoodsReceiptResponse {
    GoodsReceipt goods_receipt = 1;
}

message ReverseGoodsReceiptResponse {
    GoodsReceipt goods_receipt = 1;
}
